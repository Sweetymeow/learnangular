<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="http://cdn.jsdelivr.net/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript">
        var univCtyList = [];
        var geocodeKey = {
            url: 'https://maps.googleapis.com/maps/api/geocode/json?address=',
            address: '',
            nobias: 'location=0,0&radius=20000000',
            key: 'key=AIzaSyC-Lgj5QeFDBcaTcSeczKlhObV54M6Fb2w',
            type: 'types=geocode',
        };

        $.getJSON("../data/Univ_CountryList.json", function (json) {
            if (json) {
                univCtyList = json;
            }
            console.log(univCtyList); // this will show the info it in firebug console
            for (var i = 0; i < univCtyList.length; i++) {
                find(univCtyList[i].Country, i);
            }
            console.log(univCtyList);
            saveJson(univCtyList);
        });

        function find(country, index) {
            var xhr = new XMLHttpRequest();
            var randomAddress = univCtyList[Math.ceil(Math.random() * 118)].Country;

            geocodeKey.address = country;
            //            console.log(geocodeKey);

            //xhr.open("GET", "https://maps.googleapis.com/maps/api/geocode/json?address=Mountain+View,+CA&key=AIzaSyC-Lgj5QeFDBcaTcSeczKlhObV54M6Fb2w", false);
            //xhr.open("GET", geocodeKey.url + geocodeKey.address + "&" + geocodeKey.nobias + "&" + geocodeKey.key , false);
            var geoURL = geocodeKey.url + geocodeKey.address + "&" + geocodeKey.nobias + "&" + geocodeKey.type + "&" + geocodeKey.key;

            if (geoURL) {
                var currentLoc;
                xhr.open("GET", geoURL, false);
                xhr.send();

                currentLoc = printResult(xhr);

//                console.log(xhr.status);
//                console.log(currentLoc);

                if (geocodeKey.address === country) {
                    univCtyList[index].Lat = currentLoc.lat;
                    univCtyList[index].Lot = currentLoc.lng;
                }

            }
        }

        function printResult(xhr) {
            if (xhr.status === 200) {
                var responseText = xhr.responseText;
                var responseObj = JSON.parse(responseText);
                //                console.log(responseObj.results[0]);

                return responseObj.status == "OK" ?
                    responseObj.results[0].geometry.location : "Result: " + responseObj.status;
            } else {
                return "XHR Error";
            }
        }

        function saveJson(JsonExport) {
            //Get the file contents
//            var txtFile = "../data/test.txt";
//            var file = new File(txtFile);
            var str = JSON.stringify(JsonExport);

            //Save the file contents as a DataURI
            var dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(str);

            //Write it as the href for the link
            var link = document.getElementById('link').href = dataUri;
        }

//        function editJson(JsonExport) {
//            var txtFile = "../data/test.txt";
//            var file = new File(txtFile, "write");
//            var str = JSON.stringify(JsonExport);
//
//            log("opening file...");
//            file.open();
//            log("writing file..");
//            file.writeline(str);
//            file.close();
//        }

    </script>
</head>

<body>
    <div class="main-content">
        <div>
            # Search for AJAX Call #
            <label for="carMake">Address:</label>
            <input type="text" id="carMake" size="5" />
            <br />
            <input type="button" value="Search" onclick="find();" />
            <div id="grid">
            </div>
            <div>
                <a href="#" id="link" download="example.json">Download as JSON</a>
            </div>
        </div>
    </div>
</body>

</html>
